# Crypto Usage Analyzer

A native GNOME application for visualizing crypto-auditing data with an interactive sunburst chart, inspired by Baobab's disk usage visualization. Built with modern libadwaita design principles.

## Features

- **Modern GNOME Design**: Uses libadwaita for a polished, native GNOME 40+ look and feel
- **Two-Pane Layout**: NavigationSplitView with resizable sidebar and content area
- **Event Tree Sidebar**: Hierarchical tree view showing all cryptographic operations with counts
- **Interactive Sunburst Chart**: Visualize cryptographic operations in a hierarchical circular diagram
- **Responsive Layout**: Window sized to fit content with expandable chart area
- **Hamburger Menu**: Access file operations and about dialog through a clean menu interface
- **About Dialog**: Beautiful about window with application information and links
- **Empty State**: Beautiful status page when no data is loaded
- **Click to Zoom**: Click on any segment to zoom into that subtree
- **Zoom Banner**: When zoomed, a banner appears with a "Reset" button to return to the full view
- **Color-Coded**: Different cryptographic operations are color-coded for easy identification
- **Hover Effects**: Highlight segments on mouse hover
- **Detailed Tooltips**: Hover over segments to see operation details, counts, and breakdown of child operations
- **File Chooser**: Open any `audit.json` file generated by crypto-auditing with proper file filters

## Building

### Dependencies

You need GTK4 and libadwaita development libraries installed:

**Fedora/RHEL:**
```bash
sudo dnf install gtk4-devel libadwaita-devel cairo-devel meson
```

**Ubuntu/Debian:**
```bash
sudo apt install libgtk-4-dev libadwaita-1-dev libcairo2-dev meson
```

**Arch:**
```bash
sudo pacman -S gtk4 libadwaita cairo meson
```

### Build with Cargo

```bash
cd crypto-usage-analyzer
cargo build --release
cargo run --release
```

### Build with Meson (Recommended for System Installation)

```bash
cd crypto-usage-analyzer
meson setup builddir --prefix=/usr/local -Dprofile=release
meson compile -C builddir
```

To install:
```bash
meson install -C builddir
```

For development builds:
```bash
meson setup builddir -Dprofile=development
meson compile -C builddir
```

## Usage

1. Launch the application
2. Click the hamburger menu (â˜°) in the header bar
3. Select "Open File" to choose an `audit.json` file generated by crypto-auditing
4. The application will display:
   - **Left Sidebar**: Hierarchical tree view of all events with operation names and counts
   - **Right Content Area**: Interactive sunburst chart visualization
     - **Center**: Root node containing all events
     - **First ring**: Context groups
     - **Outer rings**: Individual cryptographic operations expanding outward with increasing detail

You can resize the sidebar by dragging the divider between the panes. Access "About Crypto Usage Analyzer" from the hamburger menu to view application information.

### Interaction

- **Hover**: Move your mouse over segments to highlight them and see detailed tooltips showing:
  - Operation name with parameters (e.g., "tls::verify [rsa_pss_rsae_sha256]")
  - Total count of operations
  - Number of child operations
  - Top 5 child operations with percentages
- **Click**: Click on any segment to zoom into that subtree (a banner will appear at the top)
- **Reset**: Click on the center/root segment or use the "Reset" button in the banner to return to the full view

## Data Format

The application expects JSON data in the crypto-auditing event format:

```json
[
  {
    "context": "unique-context-id",
    "origin": "origin-hash",
    "start": 12345678,
    "end": 12345678,
    "events": {
      "name": "tls::handshake_client",
      "tls::protocol_version": 772
    },
    "spans": [...]
  }
]
```

## Example

To test with the provided sample data:

```bash
# From the workspace root
cd crypto-usage-analyzer
cargo run --release -- ../audit.json
```

Or use the "Open" button to load `audit.json` from anywhere.

## Architecture

- **data.rs**: Data structures for parsing audit events and building tree representation
- **sunburst.rs**: Custom GTK4 widget for rendering the interactive sunburst chart using Cairo
- **main.rs**: Libadwaita application setup with modern GNOME patterns:
  - AdwApplicationWindow for the main window
  - AdwHeaderBar with hamburger menu
  - AdwNavigationSplitView for two-pane layout
  - AdwNavigationPage for sidebar and content areas
  - GtkTreeView with GtkTreeStore for hierarchical event display
  - AdwToolbarView for proper header integration
  - AdwStatusPage for empty state
  - AdwBanner for zoom notifications with reset button
  - AdwAboutWindow for application information
  - GMenu-based primary menu with actions
  - Stack-based navigation between empty and content states

## Color Scheme

Colors are generated based on a hash of the operation name and depth, ensuring consistent colors for the same operations while providing visual distinction between different types of cryptographic operations.

## License

This is a prototype application for visualizing crypto-auditing data.
